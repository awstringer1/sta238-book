<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Supplement to Chapters 17 and 19 | STA238: Probability, Statistics, and Data Analysis</title>
  <meta name="description" content="This book represents part of the course materials for STA238 at the University of Toronto" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Supplement to Chapters 17 and 19 | STA238: Probability, Statistics, and Data Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book represents part of the course materials for STA238 at the University of Toronto" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Supplement to Chapters 17 and 19 | STA238: Probability, Statistics, and Data Analysis" />
  
  <meta name="twitter:description" content="This book represents part of the course materials for STA238 at the University of Toronto" />
  

<meta name="author" content="Alison Gibbs and Alex Stringer" />


<meta name="date" content="2019-10-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-supplement-to-chapters-13-and-14.html"/>
<link rel="next" href="section-supplement-to-chapter-20.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STA238 University of Toronto</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html"><i class="fa fa-check"></i><b>2</b> Supplement to Chapters 15 and 16</a><ul>
<li class="chapter" data-level="2.1" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-old-faithful"><i class="fa fa-check"></i><b>2.1</b> Old Faithful</a><ul>
<li class="chapter" data-level="2.1.1" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-read-in-the-data"><i class="fa fa-check"></i><b>2.1.1</b> Read in the data</a></li>
<li class="chapter" data-level="2.1.2" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-graphical-summaries"><i class="fa fa-check"></i><b>2.1.2</b> Graphical Summaries</a></li>
<li class="chapter" data-level="2.1.3" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-numerical-summaries-ch-16"><i class="fa fa-check"></i><b>2.1.3</b> Numerical Summaries (Ch 16)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-drilling"><i class="fa fa-check"></i><b>2.2</b> Drilling</a><ul>
<li class="chapter" data-level="2.2.1" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-read-in-data"><i class="fa fa-check"></i><b>2.2.1</b> Read in data</a></li>
<li class="chapter" data-level="2.2.2" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-graphical-summaries-1"><i class="fa fa-check"></i><b>2.2.2</b> Graphical summaries</a></li>
<li class="chapter" data-level="2.2.3" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-numerical-summaries"><i class="fa fa-check"></i><b>2.2.3</b> Numerical summaries</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-exercises"><i class="fa fa-check"></i><b>2.3</b> Exercises</a></li>
<li class="chapter" data-level="2.4" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-extended-example-smoking-and-age-and-mortality"><i class="fa fa-check"></i><b>2.4</b> Extended example: smoking and age and mortality</a><ul>
<li class="chapter" data-level="2.4.1" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-exercises-1"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
<li class="chapter" data-level="2.4.2" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-exercises-2"><i class="fa fa-check"></i><b>2.4.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-case-study-rental-housing-in-toronto"><i class="fa fa-check"></i><b>2.5</b> Case study: rental housing in Toronto</a><ul>
<li class="chapter" data-level="2.5.1" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-load-the-data"><i class="fa fa-check"></i><b>2.5.1</b> Load the data</a></li>
<li class="chapter" data-level="2.5.2" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-analysis-i-what-does-the-data-look-like"><i class="fa fa-check"></i><b>2.5.2</b> Analysis I: what does the data look like?</a></li>
<li class="chapter" data-level="2.5.3" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-analysis-ii-do-different-wards-have-different-quality-housing"><i class="fa fa-check"></i><b>2.5.3</b> Analysis II: Do different wards have different quality housing?</a></li>
<li class="chapter" data-level="2.5.4" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-analysis-iii-trends-in-quality-over-time"><i class="fa fa-check"></i><b>2.5.4</b> Analysis III: trends in quality over time</a></li>
<li class="chapter" data-level="2.5.5" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-summary"><i class="fa fa-check"></i><b>2.5.5</b> Summary</a></li>
<li class="chapter" data-level="2.5.6" data-path="section-supplement-to-chapters-15-and-16.html"><a href="section-supplement-to-chapters-15-and-16.html#section-exercises-3"><i class="fa fa-check"></i><b>2.5.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-supplement-to-chapters-13-and-14.html"><a href="section-supplement-to-chapters-13-and-14.html"><i class="fa fa-check"></i><b>3</b> Supplement to Chapters 13 and 14</a><ul>
<li class="chapter" data-level="3.1" data-path="section-supplement-to-chapters-13-and-14.html"><a href="section-supplement-to-chapters-13-and-14.html#section-law-of-large-numbers-chapter-13"><i class="fa fa-check"></i><b>3.1</b> Law of Large Numbers (Chapter 13)</a><ul>
<li class="chapter" data-level="3.1.1" data-path="section-supplement-to-chapters-13-and-14.html"><a href="section-supplement-to-chapters-13-and-14.html#section-extended-example-the-probability-of-heads"><i class="fa fa-check"></i><b>3.1.1</b> Extended example: the probability of heads</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="section-supplement-to-chapters-13-and-14.html"><a href="section-supplement-to-chapters-13-and-14.html#section-central-limit-theorem-chapter-14"><i class="fa fa-check"></i><b>3.2</b> Central Limit Theorem (Chapter 14)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="section-supplement-to-chapters-13-and-14.html"><a href="section-supplement-to-chapters-13-and-14.html#section-extended-example-the-probability-of-heads-1"><i class="fa fa-check"></i><b>3.2.1</b> Extended example: the probability of heads</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-supplement-to-chapters-17-and-19.html"><a href="section-supplement-to-chapters-17-and-19.html"><i class="fa fa-check"></i><b>4</b> Supplement to Chapters 17 and 19</a><ul>
<li class="chapter" data-level="4.1" data-path="section-supplement-to-chapters-17-and-19.html"><a href="section-supplement-to-chapters-17-and-19.html#section-statistical-models-chapter-17"><i class="fa fa-check"></i><b>4.1</b> Statistical models (Chapter 17)</a><ul>
<li class="chapter" data-level="4.1.1" data-path="section-supplement-to-chapters-17-and-19.html"><a href="section-supplement-to-chapters-17-and-19.html#section-janka-hardness-data"><i class="fa fa-check"></i><b>4.1.1</b> Janka Hardness data</a></li>
<li class="chapter" data-level="4.1.2" data-path="section-supplement-to-chapters-17-and-19.html"><a href="section-supplement-to-chapters-17-and-19.html#section-extended-example-ttc-ridership-revenues"><i class="fa fa-check"></i><b>4.1.2</b> Extended example: TTC ridership revenues</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="section-supplement-to-chapters-17-and-19.html"><a href="section-supplement-to-chapters-17-and-19.html#section-unbiased-estimators-chapter-19"><i class="fa fa-check"></i><b>4.2</b> Unbiased Estimators (Chapter 19)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="section-supplement-to-chapters-17-and-19.html"><a href="section-supplement-to-chapters-17-and-19.html#section-simulated-network-data"><i class="fa fa-check"></i><b>4.2.1</b> Simulated network data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-supplement-to-chapter-20.html"><a href="section-supplement-to-chapter-20.html"><i class="fa fa-check"></i><b>5</b> Supplement to Chapter 20</a><ul>
<li class="chapter" data-level="5.1" data-path="section-supplement-to-chapter-20.html"><a href="section-supplement-to-chapter-20.html#section-efficiency-and-mean-square-error-chapter-20"><i class="fa fa-check"></i><b>5.1</b> Efficiency and Mean Square Error (Chapter 20)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-supplement-to-evans-rosenthal-section-7-1.html"><a href="section-supplement-to-evans-rosenthal-section-7-1.html"><i class="fa fa-check"></i><b>6</b> Supplement to Evans &amp; Rosenthal Section 7.1</a><ul>
<li class="chapter" data-level="6.1" data-path="section-supplement-to-evans-rosenthal-section-7-1.html"><a href="section-supplement-to-evans-rosenthal-section-7-1.html#section-example-bayesian-coin-flipping"><i class="fa fa-check"></i><b>6.1</b> Example: Bayesian coin flipping</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-supplement-to-chapter-18.html"><a href="section-supplement-to-chapter-18.html"><i class="fa fa-check"></i><b>7</b> Supplement to Chapter 18</a><ul>
<li class="chapter" data-level="7.1" data-path="section-supplement-to-chapter-18.html"><a href="section-supplement-to-chapter-18.html#section-the-bootstrap-chapter-18"><i class="fa fa-check"></i><b>7.1</b> The Bootstrap (Chapter 18)</a><ul>
<li class="chapter" data-level="7.1.1" data-path="section-supplement-to-chapter-18.html"><a href="section-supplement-to-chapter-18.html#section-empirical-bootstrap-old-faithful-data"><i class="fa fa-check"></i><b>7.1.1</b> Empirical bootstrap: Old Faithful data</a></li>
<li class="chapter" data-level="7.1.2" data-path="section-supplement-to-chapter-18.html"><a href="section-supplement-to-chapter-18.html#section-parametric-bootstrap-software-data"><i class="fa fa-check"></i><b>7.1.2</b> Parametric Bootstrap: software data</a></li>
<li class="chapter" data-level="7.1.3" data-path="section-supplement-to-chapter-18.html"><a href="section-supplement-to-chapter-18.html#section-extended-example-the-standard-error-of-a-proportion"><i class="fa fa-check"></i><b>7.1.3</b> Extended example: the standard error of a proportion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-supplement-to-chapter-21.html"><a href="section-supplement-to-chapter-21.html"><i class="fa fa-check"></i><b>8</b> Supplement to Chapter 21</a><ul>
<li class="chapter" data-level="8.1" data-path="section-supplement-to-chapter-21.html"><a href="section-supplement-to-chapter-21.html#section-maximum-likelihood-chapter-21"><i class="fa fa-check"></i><b>8.1</b> Maximum Likelihood (Chapter 21)</a><ul>
<li class="chapter" data-level="8.1.1" data-path="section-supplement-to-chapter-21.html"><a href="section-supplement-to-chapter-21.html#section-example-two-coins"><i class="fa fa-check"></i><b>8.1.1</b> Example: two coins</a></li>
<li class="chapter" data-level="8.1.2" data-path="section-supplement-to-chapter-21.html"><a href="section-supplement-to-chapter-21.html#section-example-unknown-coins-n-2"><i class="fa fa-check"></i><b>8.1.2</b> Example: unknown coins, <span class="math inline">\(n = 2\)</span></a></li>
<li class="chapter" data-level="8.1.3" data-path="section-supplement-to-chapter-21.html"><a href="section-supplement-to-chapter-21.html#section-example-unknown-coins-n-bigger-than-2"><i class="fa fa-check"></i><b>8.1.3</b> Example: unknown coins, <span class="math inline">\(n\)</span> bigger than <span class="math inline">\(2\)</span></a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA238: Probability, Statistics, and Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-supplement-to-chapters-17-and-19" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Supplement to Chapters 17 and 19</h1>
<p>This chapter implements much of the analysis shown in chapters 17 and 19 of
A Modern Introduction to Probability and Statistics. R code is given for the
simple textbook datasets used in the book, and then the concepts are
illustrated on real data.</p>
<p>All datasets from the book can be downloaded here: <a href="https://www.tudelft.nl/en/eemcs/the-faculty/departments/applied-mathematics/applied-probability/education/mips/" class="uri">https://www.tudelft.nl/en/eemcs/the-faculty/departments/applied-mathematics/applied-probability/education/mips/</a>.</p>
<div id="section-statistical-models-chapter-17" class="section level2">
<h2><span class="header-section-number">4.1</span> Statistical models (Chapter 17)</h2>
<p>Most of the material from chapter 17 is a review of that from chapters 15 and 16,
but in an important new context. You should be doing all exercises from chapter
17 <strong>using R</strong>, using the tools you have learned from chapters 15 and 16.</p>
<p>Here we will focus on the linear regression model. This chapter doesn’t cover
how these models are estimated, so here we will show how to use <code>R</code> to plot
regression lines. We’ll use <code>ggplot2</code> to recreate Figure 17.8, and show how
to add “smooth” non-linear regression lines to plots as well.</p>
<div id="section-janka-hardness-data" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Janka Hardness data</h3>
<p>The Janka Hardness dataset was already discussed in Chapter 15/16. Since you did
the exercises from those chapters prescribed in this supplementary book, you
have already read these data into <code>R</code>:</p>
<div class="sourceCode" id="section-cb137"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb137-1" title="1"><span class="fu">head</span> data/MIPSdata/jankahardness.txt</a></code></pre></div>
<pre><code>## 24.7 484
## 24.8 427
## 27.3 413
## 28.4 517
## 28.4 549
## 29   648
## 30.3 587
## 32.7 704
## 35.6 979
## 38.5 914</code></pre>
<p>By printing it out on the command line, you can tell that the file is <em>tab-delimited</em>.
Use <code>readr::read_delim()</code> to read it in:</p>
<div class="sourceCode" id="section-cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb139-2" title="2">janka &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_delim</span>(</a>
<a class="sourceLine" id="cb139-3" title="3">  <span class="dt">file =</span> <span class="st">&quot;data/MIPSdata/jankahardness.txt&quot;</span>,</a>
<a class="sourceLine" id="cb139-4" title="4">  <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb139-5" title="5">  <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">&quot;density&quot;</span>,<span class="st">&quot;hardness&quot;</span>),</a>
<a class="sourceLine" id="cb139-6" title="6">  <span class="dt">col_types =</span> <span class="st">&quot;nn&quot;</span></a>
<a class="sourceLine" id="cb139-7" title="7">)</a>
<a class="sourceLine" id="cb139-8" title="8"><span class="kw">glimpse</span>(janka)</a></code></pre></div>
<pre><code>## Observations: 36
## Variables: 2
## $ density  &lt;dbl&gt; 24.7, 24.8, 27.3, 28.4, 28.4, 29.0, 30.3, 32.7, 35.6, 3…
## $ hardness &lt;dbl&gt; 484, 427, 413, 517, 549, 648, 587, 704, 979, 914, 1070,…</code></pre>
<p>Create a scatterplot with <code>ggplot2</code>:</p>
<div class="sourceCode" id="section-cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1">jankascatter &lt;-<span class="st"> </span>janka <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> density,<span class="dt">y =</span> hardness)) <span class="op">+</span></a>
<a class="sourceLine" id="cb141-3" title="3"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb141-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb141-5" title="5"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">20</span>,<span class="dv">80</span>,<span class="dt">by=</span><span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb141-6" title="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">3500</span>,<span class="dt">by=</span><span class="dv">500</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb141-7" title="7"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">80</span>),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3500</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb141-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Wood density&quot;</span>,</a>
<a class="sourceLine" id="cb141-9" title="9">       <span class="dt">y =</span> <span class="st">&quot;Hardness&quot;</span>)</a>
<a class="sourceLine" id="cb141-10" title="10">jankascatter</a></code></pre></div>
<p><img src="book_files/figure-html/janka-2-1.png" width="672" /></p>
<p>To add a line to a plot, use <code>geom_abline()</code>. We can use this to recreate the regression
line from Figure 17.8:</p>
<div class="sourceCode" id="section-cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">jankascatter <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-2" title="2"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="fl">57.51</span>,<span class="dt">intercept =</span> <span class="fl">-1160.5</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/janka-3-1.png" width="672" /></p>
<p>But how did the book calculate these values? We’ll answer this question in a later
chapter. But for now, it would still be nice to get the computer to compute these
values for us rather than typing them in manually. We can do this using the
<code>geom_smooth()</code> function in <code>ggplot2</code>:</p>
<div class="sourceCode" id="section-cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1">jankascatter <span class="op">+</span></a>
<a class="sourceLine" id="cb143-2" title="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="dt">se =</span> <span class="ot">FALSE</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">size =</span> <span class="fl">.5</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/janka-4-1.png" width="672" /></p>
<p>The “lm” stands for “linear model” and the “se” stands for “standard error”; leaving
this at its default of “TRUE” would add error bars to the line, which we’ll learn
about later (give it a try though).</p>
<p>We can also add a non-linear curve to the plot using this technique. Most of the
approaches to doing non-linear regression involve breaking the data up into small
chunks based on the x-axis values, and then doing linear regression in each chunk
and joining the resulting lines. The “loess” non-linear regression line is an
example of this approach. It roughly stands for “local regression and smoothing
splines”. We can add this using <code>ggplot2</code> as well:</p>
<div class="sourceCode" id="section-cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1">jankascatter <span class="op">+</span></a>
<a class="sourceLine" id="cb144-2" title="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>,<span class="dt">se =</span> <span class="ot">FALSE</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">size =</span> <span class="fl">.5</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/janka-5-1.png" width="672" /></p>
<p>See how it’s a bit more wiggly, but still pretty straight? The data really does
look like it supports a linear relationship between density and hardness. This
is not common in modern practice!</p>
</div>
<div id="section-extended-example-ttc-ridership-revenues" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Extended example: TTC ridership revenues</h3>
<p>Toronto’s population is growing over time. This puts strain on our outdated
public transit system. But it should also lead to increased revenues. According to
(<a href="https://globalnews.ca/news/1670796/how-does-the-ttcs-funding-compare-to-other-transit-agencies/" class="uri">https://globalnews.ca/news/1670796/how-does-the-ttcs-funding-compare-to-other-transit-agencies/</a>)[a news
article from a few years back], the TTC is the least-subsidized major transit agency
in North America, which means that its operating budget is the most dependent on
fare revenue out of any in all of the US and Canada. Tracking how ridership
revenues are changing over time is very important.</p>
<p>The city does do this. Go to (<a href="https://www.toronto.ca/city-government/data-research-maps/toronto-progress-portal/" class="uri">https://www.toronto.ca/city-government/data-research-maps/toronto-progress-portal/</a>)[
the City of Toronto Progress Portal] and type “TTC” and click on the box that says
“TTC Ridership Revenues” to see a report. You can download the data from here, but
since it’s a bit tricky to describe exactly how, I have posted the file
<code>ttc-ridership-revenues.csv</code> on Quercus. We are going to read these data into <code>R</code>
and analyze the relationship between <code>year</code> and <code>revenue</code>.</p>
<p>If you’re thinking “that sounds really easy, we just did that!”… just keep reading.</p>
<p>First, print the data out and count the number of rows on the command line:</p>
<div class="sourceCode" id="section-cb145"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb145-1" title="1"><span class="fu">head</span> data/ttc-ridership-revenues.csv</a>
<a class="sourceLine" id="cb145-2" title="2"><span class="fu">wc</span> -l data/ttc-ridership-revenues.csv</a></code></pre></div>
<pre><code>## Year,Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec
## 2007 YTD Actual,$70600000,$131200000,$204600000,$264900000,$322000000,$395100000,$452100000,$507500000,$585600000,$646900000,$712500000,$774700000
## 2008 YTD Actual,$72700000,$137600000,$217500000,$278200000,$340600000,$419600000,$482400000,$544100000,$629000000,$696400000,$766600000,$837000000
## 2009 YTD Actual,$69300000,$135400000,$216600000,$280500000,$344000000,$422100000,$483400000,$543500000,$627200000,$693900000,$762400000,$834900000
## 2010 YTD Actual,$72200000,$143400000,$230700000,$302400000,$372500000,$459100000,$528800000,$595700000,$689100000,$764500000,$842000000,$929300000
## 2011 YTD Actual,$75300000,$150800000,$244400000,$318300000,$392400000,$484800000,$557300000,$625500000,$722000000,$799500000,$879100000,$969900000
## 2012 YTD Actual,$75500000,$154800000,$253900000,$331600000,$408300000,$507100000,$581800000,$654300000,$755800000,$835900000,$919100000,$1017600000
## 2013 YTD Actual,$93200000,$176600000,$278200000,$360300000,$439700000,$539700000,$617400000,$693500000,$799600000,$882500000,$968900000,$1052100000
## 2014 YTD Actual,$92200000,$178900000,$284400000,$367200000,$449700000,$552300000,$633200000,$712200000,$822000000,$907900000,$998200000,$1086500000
## 2015 YTD Actual,$90600000,$178200000,$284100000,$370500000,$455300000,$559600000,$641700000,$721400000,$833200000,$920800000,$1011600000,$1107300000
##       14 data/ttc-ridership-revenues.csv</code></pre>
<p>Yikes! Real data is messy. This data isn’t even that messy and it still seems messy.</p>
<p>We see that the file is comma-separated and has a header. The first column is
text and the others are… well, they’re supposed to be numeric, but they are
stored in the file with dollar signs. WHY! This kind of thing is super annoying
and super common.</p>
<p>We could remove the dollar signs from the text file directly using <code>sed</code> or a
similar UNIX-based tool, but I prefer whenever possible to keep all my analysis
on one platform. We’ll read it into <code>R</code> as-is and then parse and change datatypes
there:</p>
<div class="sourceCode" id="section-cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1"><span class="co"># Read in the data</span></a>
<a class="sourceLine" id="cb147-2" title="2">ridership &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(</a>
<a class="sourceLine" id="cb147-3" title="3">  <span class="dt">file =</span> <span class="st">&quot;data/ttc-ridership-revenues.csv&quot;</span>,</a>
<a class="sourceLine" id="cb147-4" title="4">  <span class="dt">col_names =</span> <span class="ot">TRUE</span>, <span class="co"># Tells readr to read the column names from the first line of the file.</span></a>
<a class="sourceLine" id="cb147-5" title="5">  <span class="dt">col_types =</span> stringr<span class="op">::</span><span class="kw">str_c</span>(<span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>,<span class="dv">13</span>),<span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>) <span class="co"># Read all 13 columns as &quot;c&quot;haracter</span></a>
<a class="sourceLine" id="cb147-6" title="6">)</a>
<a class="sourceLine" id="cb147-7" title="7"><span class="kw">glimpse</span>(ridership)</a></code></pre></div>
<pre><code>## Observations: 13
## Variables: 13
## $ Year &lt;chr&gt; &quot;2007 YTD Actual&quot;, &quot;2008 YTD Actual&quot;, &quot;2009 YTD Actual&quot;, &quot;2…
## $ Jan  &lt;chr&gt; &quot;$70600000&quot;, &quot;$72700000&quot;, &quot;$69300000&quot;, &quot;$72200000&quot;, &quot;$75300…
## $ Feb  &lt;chr&gt; &quot;$131200000&quot;, &quot;$137600000&quot;, &quot;$135400000&quot;, &quot;$143400000&quot;, &quot;$1…
## $ Mar  &lt;chr&gt; &quot;$204600000&quot;, &quot;$217500000&quot;, &quot;$216600000&quot;, &quot;$230700000&quot;, &quot;$2…
## $ Apr  &lt;chr&gt; &quot;$264900000&quot;, &quot;$278200000&quot;, &quot;$280500000&quot;, &quot;$302400000&quot;, &quot;$3…
## $ May  &lt;chr&gt; &quot;$322000000&quot;, &quot;$340600000&quot;, &quot;$344000000&quot;, &quot;$372500000&quot;, &quot;$3…
## $ Jun  &lt;chr&gt; &quot;$395100000&quot;, &quot;$419600000&quot;, &quot;$422100000&quot;, &quot;$459100000&quot;, &quot;$4…
## $ Jul  &lt;chr&gt; &quot;$452100000&quot;, &quot;$482400000&quot;, &quot;$483400000&quot;, &quot;$528800000&quot;, &quot;$5…
## $ Aug  &lt;chr&gt; &quot;$507500000&quot;, &quot;$544100000&quot;, &quot;$543500000&quot;, &quot;$595700000&quot;, &quot;$6…
## $ Sep  &lt;chr&gt; &quot;$585600000&quot;, &quot;$629000000&quot;, &quot;$627200000&quot;, &quot;$689100000&quot;, &quot;$7…
## $ Oct  &lt;chr&gt; &quot;$646900000&quot;, &quot;$696400000&quot;, &quot;$693900000&quot;, &quot;$764500000&quot;, &quot;$7…
## $ Nov  &lt;chr&gt; &quot;$712500000&quot;, &quot;$766600000&quot;, &quot;$762400000&quot;, &quot;$842000000&quot;, &quot;$8…
## $ Dec  &lt;chr&gt; &quot;$774700000&quot;, &quot;$837000000&quot;, &quot;$834900000&quot;, &quot;$929300000&quot;, &quot;$9…</code></pre>
<p>This does not look like it’s in a form ready to analyze. Some problems:</p>
<ol style="list-style-type: decimal">
<li>The <code>Year</code> has unwanted text in it. We just want the number representing what
year it is.</li>
<li>The revenue is stored across 12 columns, one for each month. We want the annual
revenue for our analysis.</li>
<li>The actual numeric revenue is stored as text with a dollar sign. We need to
parse out the number part and convert to a numeric datatype before we can analyze it.</li>
</ol>
<p>Problems 1 and 3 require a bit of text parsing; Problem 2 requires converting from
“wide” to “long” format. Let’s do it:</p>
<div class="sourceCode" id="section-cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" title="1"><span class="co"># PROBLEM 1: Year</span></a>
<a class="sourceLine" id="cb149-2" title="2"><span class="co"># To parse out only the number part, use a regular expression.</span></a>
<a class="sourceLine" id="cb149-3" title="3"><span class="co"># Our string starts with a four digit number which starts with 20. We want to capture this number</span></a>
<a class="sourceLine" id="cb149-4" title="4"><span class="co"># and nothing else.</span></a>
<a class="sourceLine" id="cb149-5" title="5"><span class="co"># The ^ means &quot;the start of the string&quot;.</span></a>
<a class="sourceLine" id="cb149-6" title="6"><span class="co"># The [20]{2} means &quot;a 0 or a 2, exactly twice&quot;</span></a>
<a class="sourceLine" id="cb149-7" title="7"><span class="co"># The [0-9]{2} means &quot;anything from 0 - 9, exactly twice&quot;</span></a>
<a class="sourceLine" id="cb149-8" title="8">year_regex &lt;-<span class="st"> &quot;^[20]{2}[0-9]{2}&quot;</span></a>
<a class="sourceLine" id="cb149-9" title="9"><span class="co"># Use stringr::str_extract to extract a substring matching the regular expression:</span></a>
<a class="sourceLine" id="cb149-10" title="10">stringr<span class="op">::</span><span class="kw">str_extract</span>(<span class="st">&quot;2007 YTD Actual&quot;</span>,year_regex)</a></code></pre></div>
<pre><code>## [1] &quot;2007&quot;</code></pre>
<div class="sourceCode" id="section-cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1"><span class="co"># PROBLEM 2: wide to long</span></a>
<a class="sourceLine" id="cb151-2" title="2"><span class="co"># Use the tidyr::gather() function for &quot;gather&quot;ing columns and putting them</span></a>
<a class="sourceLine" id="cb151-3" title="3"><span class="co"># into one column:</span></a>
<a class="sourceLine" id="cb151-4" title="4">ridership <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-5" title="5"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">gather</span>(month,revenue,Jan<span class="op">:</span>Dec)</a></code></pre></div>
<pre><code>## # A tibble: 156 x 3
##    Year            month revenue  
##    &lt;chr&gt;           &lt;chr&gt; &lt;chr&gt;    
##  1 2007 YTD Actual Jan   $70600000
##  2 2008 YTD Actual Jan   $72700000
##  3 2009 YTD Actual Jan   $69300000
##  4 2010 YTD Actual Jan   $72200000
##  5 2011 YTD Actual Jan   $75300000
##  6 2012 YTD Actual Jan   $75500000
##  7 2013 YTD Actual Jan   $93200000
##  8 2014 YTD Actual Jan   $92200000
##  9 2015 YTD Actual Jan   $90600000
## 10 2016 YTD Actual Jan   $90800000
## # … with 146 more rows</code></pre>
<div class="sourceCode" id="section-cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" title="1"><span class="co"># PROBLEM 3: removing the dollar sign</span></a>
<a class="sourceLine" id="cb153-2" title="2"><span class="co"># Again, use text matching. Because $ is itself a special character,</span></a>
<a class="sourceLine" id="cb153-3" title="3"><span class="co"># to match it, you have to &quot;escape&quot; it using a backslash</span></a>
<a class="sourceLine" id="cb153-4" title="4">dollar_regex &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">$&quot;</span></a>
<a class="sourceLine" id="cb153-5" title="5"><span class="co"># Remove matching strings using stringr::str_remove()</span></a>
<a class="sourceLine" id="cb153-6" title="6">stringr<span class="op">::</span><span class="kw">str_remove</span>(<span class="st">&quot;$1234&quot;</span>,dollar_regex)</a></code></pre></div>
<pre><code>## [1] &quot;1234&quot;</code></pre>
<div class="sourceCode" id="section-cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" title="1"><span class="co"># Now, combine all these into one data cleaning pipeline.</span></a>
<a class="sourceLine" id="cb155-2" title="2"><span class="co"># Remember we have monthly revenue, so to get yearly revenue, we sum</span></a>
<a class="sourceLine" id="cb155-3" title="3"><span class="co"># over months.</span></a>
<a class="sourceLine" id="cb155-4" title="4">ridership_clean &lt;-<span class="st"> </span>ridership <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb155-5" title="5"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">gather</span>(month,revenue,Jan<span class="op">:</span>Dec) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># &quot;transmute&quot; is like mutate, but it deletes all original columns</span></a>
<a class="sourceLine" id="cb155-6" title="6"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">year =</span> stringr<span class="op">::</span><span class="kw">str_extract</span>(Year,year_regex),</a>
<a class="sourceLine" id="cb155-7" title="7">            <span class="dt">revenue =</span> stringr<span class="op">::</span><span class="kw">str_remove</span>(revenue,dollar_regex)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb155-8" title="8"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;year&quot;</span>,<span class="st">&quot;revenue&quot;</span>),as.numeric) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Turn both year and revenue into numeric variables</span></a>
<a class="sourceLine" id="cb155-9" title="9"><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Sum revenue for each year to get yearly revenue</span></a>
<a class="sourceLine" id="cb155-10" title="10"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">revenue =</span> <span class="kw">sum</span>(revenue)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb155-11" title="11"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">&lt;</span><span class="st"> </span><span class="dv">2019</span>) <span class="co"># 2019 has incomplete data, so remove it</span></a>
<a class="sourceLine" id="cb155-12" title="12"><span class="kw">glimpse</span>(ridership_clean)</a></code></pre></div>
<pre><code>## Observations: 12
## Variables: 2
## $ year    &lt;dbl&gt; 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 20…
## $ revenue &lt;dbl&gt; 5067700000, 5421700000, 5413200000, 5929700000, 62193000…</code></pre>
<p>That looks a lot better! As usual, you should run each line of code one by one to
understand what is happening.</p>
<p>Because we went to the effort of cleaning the data, we can now plot it easily:</p>
<div class="sourceCode" id="section-cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" title="1">ridershipscatter &lt;-<span class="st"> </span>ridership_clean <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year,<span class="dt">y =</span> revenue)) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-3" title="3"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb157-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb157-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Annual ridership revenues for the TTC&quot;</span>,</a>
<a class="sourceLine" id="cb157-6" title="6">       <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>,</a>
<a class="sourceLine" id="cb157-7" title="7">       <span class="dt">y =</span> <span class="st">&quot;Revenue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-8" title="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="co"># Make the y-axis pretty</span></a>
<a class="sourceLine" id="cb157-9" title="9">ridershipscatter</a></code></pre></div>
<p><img src="book_files/figure-html/ttc-4-1.png" width="672" /></p>
<p>Add a linear and non-linear regression line:</p>
<div class="sourceCode" id="section-cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1">leftplot &lt;-<span class="st"> </span>ridershipscatter <span class="op">+</span></a>
<a class="sourceLine" id="cb158-2" title="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="dt">size =</span> <span class="fl">.5</span>,<span class="dt">se =</span> <span class="ot">FALSE</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-3" title="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Linear regression line&quot;</span>)</a>
<a class="sourceLine" id="cb158-4" title="4">rightplot &lt;-<span class="st"> </span>ridershipscatter <span class="op">+</span></a>
<a class="sourceLine" id="cb158-5" title="5"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>,<span class="dt">size =</span> <span class="fl">.5</span>,<span class="dt">se =</span> <span class="ot">FALSE</span>,<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Non-linear regression line&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb158-7" title="7"></a>
<a class="sourceLine" id="cb158-8" title="8">cowplot<span class="op">::</span><span class="kw">plot_grid</span>(leftplot,</a>
<a class="sourceLine" id="cb158-9" title="9">                   rightplot <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>()), <span class="co"># Take away the second plot&#39;s y-axis</span></a>
<a class="sourceLine" id="cb158-10" title="10">                   <span class="dt">nrow=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/ttc-5-1.png" width="672" /></p>
<p><strong>Exercise</strong>: re-do this analysis but don’t sum over month. This will give 12
points per year on the plot. Do one linear regression per month.
Recreate the following plot yourself:</p>
<p><img src="book_files/figure-html/ttc-6-1.png" width="672" /></p>
<p>To do this, you have to create a dataset that looks like this:</p>
<pre><code>## Observations: 144
## Variables: 3
## $ month   &lt;chr&gt; &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, …
## $ revenue &lt;dbl&gt; 70600000, 72700000, 69300000, 72200000, 75300000, 755000…
## $ year    &lt;dbl&gt; 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 20…</code></pre>
<p>You should make the following modifications:</p>
<ol style="list-style-type: decimal">
<li>Replace <code>transmute</code> with <code>mutate</code> so you don’t delete the <code>month</code> column.</li>
<li>Replace <code>aes(x = year,y = revenue)</code> with <code>aes(x = year,y = revenue,group = month,colour = month)</code>
in the call to <code>ggplot</code>.</li>
<li>Don’t sum over months.</li>
</ol>
</div>
</div>
<div id="section-unbiased-estimators-chapter-19" class="section level2">
<h2><span class="header-section-number">4.2</span> Unbiased Estimators (Chapter 19)</h2>
<p>Unbiasedness is one property of an estimator that the book claims is attractive.
Let’s investigate this by recreating some of their simulations.</p>
<div id="section-simulated-network-data" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Simulated network data</h3>
<p>Figure 19.1 shows histograms of simulations of samples <span class="math inline">\(X_{1},\ldots,X_{n}\)</span> of size <span class="math inline">\(n=30\)</span> from a
<span class="math inline">\(X\sim\text{Poisson}(\log 10)\)</span> distribution. We want to estimate the parameter <span class="math inline">\(p_{0}\)</span>,
which is the probability that <span class="math inline">\(X = 0\)</span>:
<span class="math display">\[\begin{equation}
p_{0} = P(X = 0) = e^{-\lambda}
\end{equation}\]</span>
where <span class="math inline">\(\lambda = E(X) = \log 10\)</span> in this example. The book suggests two estimators,
<span class="math inline">\(S = \sum_{i=1}^{n}\mathbb{1}(X_{i} = 0)\)</span> and <span class="math inline">\(T = e^{-\bar{X}_{n}}\)</span>. <span class="math inline">\(S\)</span> corresponds
to calculating the sample proportion of times <span class="math inline">\(X_{i}=0\)</span>, and <span class="math inline">\(T\)</span> corresponds to
estimating the population mean <span class="math inline">\(\lambda\)</span> using the sample mean <span class="math inline">\(\bar{X}_{n}\)</span> and
then plugging this in to the actual formula for the value <span class="math inline">\(p_{0}\)</span>. These both come
from somewhere, and we’ll see this when we talk about Maximum Likelihood. For now,
just take them as both being candidates for an estimator of <span class="math inline">\(p_{0}\)</span>.</p>
<p>Let’s investigate their sampling distributions by recreating the simulation from
the book:</p>
<div class="sourceCode" id="section-cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="kw">set.seed</span>(<span class="dv">6574564</span>)</a>
<a class="sourceLine" id="cb160-2" title="2"><span class="co"># Simulate 500 random samples of size 30 from a poisson(log(10))</span></a>
<a class="sourceLine" id="cb160-3" title="3"><span class="co"># You need the purrr package, part of the tidyverse, for the map() function</span></a>
<a class="sourceLine" id="cb160-4" title="4">N &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb160-5" title="5">n &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb160-6" title="6">lambda &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb160-7" title="7">p0 &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>lambda) <span class="co"># True value of p0</span></a>
<a class="sourceLine" id="cb160-8" title="8"></a>
<a class="sourceLine" id="cb160-9" title="9"><span class="co"># Simulate the samples</span></a>
<a class="sourceLine" id="cb160-10" title="10">samplelist &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>N <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb160-11" title="11"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">rpois</span>(n,lambda))</a>
<a class="sourceLine" id="cb160-12" title="12"></a>
<a class="sourceLine" id="cb160-13" title="13"><span class="co"># Write functions to compute each estimator</span></a>
<a class="sourceLine" id="cb160-14" title="14">compute_S &lt;-<span class="st"> </span><span class="cf">function</span>(samp) <span class="kw">mean</span>(samp <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb160-15" title="15">compute_T &lt;-<span class="st"> </span><span class="cf">function</span>(samp) <span class="kw">exp</span>(<span class="op">-</span><span class="kw">mean</span>(samp))</a>
<a class="sourceLine" id="cb160-16" title="16"></a>
<a class="sourceLine" id="cb160-17" title="17"><span class="co"># Compute them and then store the results in a tibble()</span></a>
<a class="sourceLine" id="cb160-18" title="18">estimators &lt;-<span class="st"> </span>samplelist <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb160-19" title="19"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">c</span>(<span class="dt">S =</span> <span class="kw">compute_S</span>(.x),<span class="dt">T =</span> <span class="kw">compute_T</span>(.x))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb160-20" title="20"><span class="st">  </span><span class="kw">reduce</span>(bind_rows)</a>
<a class="sourceLine" id="cb160-21" title="21"><span class="kw">glimpse</span>(estimators)</a></code></pre></div>
<pre><code>## Observations: 500
## Variables: 2
## $ S &lt;dbl&gt; 0.10000000, 0.16666667, 0.16666667, 0.13333333, 0.03333333, 0.…
## $ T &lt;dbl&gt; 0.08774387, 0.12245643, 0.13089846, 0.14956862, 0.08774387, 0.…</code></pre>
<div class="sourceCode" id="section-cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="co"># Create the plots</span></a>
<a class="sourceLine" id="cb162-2" title="2">plt_S &lt;-<span class="st"> </span>estimators <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> S)) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-4" title="4"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb162-5" title="5"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>,<span class="dt">bins =</span> <span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-6" title="6"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">250</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-7" title="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> p0,<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,<span class="dt">linetype =</span> <span class="st">&quot;dotdash&quot;</span>)</a>
<a class="sourceLine" id="cb162-8" title="8"></a>
<a class="sourceLine" id="cb162-9" title="9">plt_T &lt;-<span class="st"> </span>estimators <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-10" title="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> T)) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-11" title="11"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb162-12" title="12"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>,<span class="dt">bins =</span> <span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-13" title="13"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">250</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb162-14" title="14"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> p0,<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>,<span class="dt">linetype =</span> <span class="st">&quot;dotdash&quot;</span>)</a>
<a class="sourceLine" id="cb162-15" title="15"></a>
<a class="sourceLine" id="cb162-16" title="16">cowplot<span class="op">::</span><span class="kw">plot_grid</span>(plt_S,plt_T,<span class="dt">nrow=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="book_files/figure-html/poisson-1-1.png" width="672" /></p>
<div class="sourceCode" id="section-cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1"><span class="co"># Compute the mean of each:</span></a>
<a class="sourceLine" id="cb163-2" title="2">estimators <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-3" title="3"><span class="st">  </span><span class="kw">summarize_all</span>(mean)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       S     T
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 0.101 0.103</code></pre>
<p><strong>Exercise</strong>: <span class="math inline">\(S\)</span> is unbiased and <span class="math inline">\(T\)</span> is biased, as shown in the book. Which estimator
would you prefer? Compute a five number summary for <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span> from our simulations,
recreating the following:</p>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.06667 0.10000 0.10140 0.13333 0.26667</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.03122 0.08209 0.10026 0.10346 0.12246 0.23069</code></pre>
<p>Do you see any meaningful differences? Do the sampling distributions of <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span>
concentrate around <span class="math inline">\(p0\)</span> in the same way?</p>
<p>Now, compute the mode (most frequently-observed value) of <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span>. You should get the following:</p>
<div class="sourceCode" id="section-cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1">mode_S &lt;-<span class="st"> </span>estimators <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(S) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cnt =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cnt)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-5" title="5"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-6" title="6"><span class="st">  </span><span class="kw">pull</span>(S)</a>
<a class="sourceLine" id="cb167-7" title="7"></a>
<a class="sourceLine" id="cb167-8" title="8">mode_T &lt;-<span class="st"> </span>estimators <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-9" title="9"><span class="st">  </span><span class="kw">group_by</span>(T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-10" title="10"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cnt =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-11" title="11"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cnt)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-12" title="12"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-13" title="13"><span class="st">  </span><span class="kw">pull</span>(T)</a>
<a class="sourceLine" id="cb167-14" title="14"></a>
<a class="sourceLine" id="cb167-15" title="15"><span class="kw">cat</span>(<span class="st">&quot;The mode of S is &quot;</span>,mode_S,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## The mode of S is  0.06666667</code></pre>
<div class="sourceCode" id="section-cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1"><span class="kw">cat</span>(<span class="st">&quot;The mode of T is &quot;</span>,mode_T,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## The mode of T is  0.09697197</code></pre>
<p>(You’re going to have to figure out how to compute a mode in <code>R</code>. That’s part of
the exercise).</p>
<p>What do you think about this? Does this contradict <span class="math inline">\(S\)</span> being unbiased and <span class="math inline">\(T\)</span> being
biased? Does it change your opinion about which is a better estimator?</p>
<p>Finally, compute the square root of the average squared distance of <span class="math inline">\(S\)</span> and <span class="math inline">\(T\)</span>
from the true value <span class="math inline">\(p_{0}\)</span>. You should get:</p>
<pre><code>## # A tibble: 1 x 2
##        S      T
##    &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.0550 0.0299</code></pre>
<p>We will see shortly that this quantity, the <strong>mean-squared error</strong> of an estimator,
is much more representative of the quality of an estimator than the bias on its own.
Note, of course, that since it depends on the true value, it can’t ever be computed
in a real data analysis. It’s a mathematical construct.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-supplement-to-chapters-13-and-14.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-supplement-to-chapter-20.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
